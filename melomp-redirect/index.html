<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Returning to Melo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: #0F1E17;
        color: white;
      }
      .box {
        text-align: center;
        padding: 24px;
      }
      a {
        color: #7FAF9B;
        font-size: 18px;
        text-decoration: none;
        font-weight: 700;
      }
    </style>
  </head>

  <body>
    <div class="box">
      <h2>Redirecting back to Melo‚Ä¶</h2>
      <p>Please wait while we finish payout setup.</p>
    </div>

    <script>
      console.log("üîÅ Melo redirect page loaded");

      const ts = Date.now();

      /**
       * CRITICAL:
       * We now deep link to melomp://wallet (NOT seller-hub/wallet)
       * because you created:
       * app/wallet.tsx (redirect shim)
       *
       * This prevents:
       * - unmatched route
       * - //wallet bug
       * - Stripe deep link inconsistencies
       */
      const deepLink = "melomp://wallet?from=stripe&ts=" + ts;

      console.log("üöÄ Redirecting to:", deepLink);

      // Attempt automatic deep link (primary)
      setTimeout(() => {
        try {
          window.location.replace(deepLink);
        } catch (e) {
          console.error("Deep link failed:", e);
        }
      }, 600);

      // Strong fallback for mobile browsers (Safari/Chrome)
      setTimeout(() => {
        document.body.innerHTML = `
          <div class="box">
            <h2>Almost there!</h2>
            <p>Tap below if the app did not open automatically:</p>
            <br/>
            <a href="${deepLink}">
              Open Melo App
            </a>
          </div>
        `;
      }, 2200);

      // Final safety fallback (prevents 404 dead-end)
      setTimeout(() => {
        console.warn("‚ö†Ô∏è Final fallback triggered");
        window.location.href = deepLink;
      }, 4000);
    </script>
  </body>
</html>
